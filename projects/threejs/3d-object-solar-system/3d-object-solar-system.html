<!DOCTYPE html>
<html lang="en">
	<head>
		<title>3D Object Planets' Solar System with Trackball Controls</title>
		<meta charset="utf-8">
        <meta name="author" content="Rúben André Barreiro" />
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			html, body {
				width: 100%;
				height: 100%;
				overflow: hidden;
			}
			
			body {
				color: #000;
				font-family:Monospace;
				font-size:13px;
				text-align:center;
				font-weight: bold;

				background-color: #000000;
				margin: 0px;
			}

			#info {
				color:#ffffff;
				position: absolute;
				top: 0px; width: 100%;
				padding: 5px;
				box-sizing: border-box;
			}

			a {
				color: red;
			}
		</style>
	</head>

	<body>
		<div id="info">
            <h1>3D Object's Solar System</h1>
            <h3>with Sun, Planets, Moons, Orbits and Trackball Controls</h3>
            <br/>
            Made with <a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> by <a href="https://rubenandrebarreiro.github.io/" target="_blank" rel="noopener"> Rúben André Barreiro</a>
            <br/>
            <br/>
            <h2><b>INSTRUCTIONS:</b></h2>
            MOVE mouse &amp; press LEFT/A: rotate, MIDDLE/S: zoom, RIGHT/D: pan
		</div>

		<script src="../common/build/three.js"></script>
		<script src="../common/js/controls/TrackballControls.js"></script>

		<script src="../common/js/WebGL.js"></script>
		<script src="../common/js/libs/stats.min.js"></script>

		<script>

			if(WEBGL.isWebGLAvailable() === false) {
                document.body.appendChild(WEBGL.getWebGLErrorMessage());
			}

			var camera, controls, solarSystemScene, renderer, stats;

            const yAxis = new THREE.Vector3(0, 1, 0).normalize();

            // Sun Element
            var sunMesh;
            
            // Mercury's Elements
            var mercuryOrbitMesh, mercuryPlanetMesh, mercuryPivot;

            
			init();
			animate();

			function init() {

				camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 100000);
				camera.position.y = 20;
                camera.position.z = 40000;
                
				controls = new THREE.TrackballControls(camera);

				controls.rotateSpeed = 1.0;
				controls.zoomSpeed = 1.2;
				controls.panSpeed = 0.8;

				controls.noZoom = false;
				controls.noPan = false;

				controls.staticMoving = true;
				controls.dynamicDampingFactor = 0.3;

				controls.keys = [ 65, 83, 68 ];

				controls.addEventListener('change', render);

				// Creating the Galaxy's Scene
				solarSystemScene = new THREE.Scene();

                var loader = new THREE.TextureLoader();
                loader.setCrossOrigin("");
                
                var gridXZ = new THREE.GridHelper(80000, 20, new THREE.Color(0xff0000), new THREE.Color(0xffffff));
                solarSystemScene.add(gridXZ);
				
                backgroundTexture = loader.load("imgs/stars-milky-way.jpg",
                    function (texture) {
                       var image = texture.image;
                       var backgroundWidth= image.width;
                       var backgroundHeight = image.height;
                       onWindowResize();
                    }
                );

                solarSystemScene.background = backgroundTexture;
                backgroundTexture.wrapS = THREE.MirroredRepeatWrapping;
                backgroundTexture.wrapT = THREE.MirroredRepeatWrapping;
                
                // Adding the elements (Sun, Planets and their respective Orbits and Moons)
                
                // INFO:
                // 1) It will be used a size scale of 0.001 kms to determine the size of the planets
                // 2) It will be used a size scale of 0.000,1 respective orbits
                // The final size of each planet and their respective orbits will be rounded to the units or to the first decimal, since it's possible
                
                // 1) SUN's setup
                sunTexture = loader.load('imgs/sun-texture.jpg', function (texture) {});
                
                // The radius of Sun is 695,508 kms (Resolution: [695,508 * 0.01] = 696)
                var sunGeometry = new THREE.SphereGeometry(696, 40, 40);
                var sunMaterial = new THREE.MeshBasicMaterial(
                    {
                        map: sunTexture,
                        overdraw: 0.5
                    }
                );

                sunMesh = new THREE.Mesh(sunGeometry, sunMaterial);

                solarSystemScene.add(sunMesh);
                
                
                // 2) MERCURY's setup
                
                // The average distance/orbit's radius from the Sun ranging from 46,000,000 kms to 70,000,000 kms
                // It will be used an average orbit's radius of an interval between 57,500,000 and 58,000,000 (Resolution: [57,500,000 * 0.000,1] = 5,750 and [58,000,000 * 0.000,1] = 5,800)
                var mercuryOrbitGeometry = new THREE.RingGeometry(5750, 5800, 60);
                var mercuryOrbitMaterial = new THREE.MeshBasicMaterial(
                    {
                        color: 0xffff00,
                        side: THREE.DoubleSide
                    }
                );
                
                mercuryOrbitMesh = new THREE.Mesh(mercuryOrbitGeometry, mercuryOrbitMaterial);
                mercuryOrbitMesh.rotation.x = Math.PI / 2;
                
                
                mercuryPlanetTexture = loader.load('imgs/mercury-planet-texture.jpg', function (texture) {});
                
                // The radius of Mercury is 2,440 kms (Resolution: [2,440 * 0.001] = 2)
                var mercuryPlanetGeometry = new THREE.SphereGeometry(240, 40, 40);
                var mercuryPlanetMaterial = new THREE.MeshBasicMaterial(
                    {
                        map: mercuryPlanetTexture,
                        overdraw: 0.5
                    }
                );
                
                mercuryPlanetMesh = new THREE.Mesh(mercuryPlanetGeometry, mercuryPlanetMaterial);            
                mercuryPlanetMesh.position.z = 5775;
                
                mercuryPivot = new THREE.Group();
                
                mercuryPivot.add(mercuryOrbitMesh);
                mercuryPivot.add(mercuryPlanetMesh);
                
                mercuryPivot.position.x = -1600;
                
                solarSystemScene.add(mercuryPivot);
                
                
                // Creating all the solar system's scene's lights
				var directionalLight1 = new THREE.DirectionalLight(0xffffff);
				directionalLight1.position.set(1, 1, 1);
				solarSystemScene.add(directionalLight1);

				var directionalLight2 = new THREE.DirectionalLight(0x002288);
				directionalLight2.position.set(- 1, - 1, - 1);
				solarSystemScene.add(directionalLight2);

				var ambientLight = new THREE.AmbientLight(0x222222);
				solarSystemScene.add(ambientLight);

				
                // Creating the renderer
				renderer = new THREE.WebGLRenderer(
                    {
                        antialias: true
                    }
                );
				
                renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize(window.innerWidth, window.innerHeight);
				document.body.appendChild(renderer.domElement);

				stats = new Stats();
				document.body.appendChild(stats.dom);

				window.addEventListener('resize', onWindowResize, false);

                render();
			}

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize(window.innerWidth, window.innerHeight);

				controls.handleResize();

				render();
			}
            
			function animate() {
			    requestAnimationFrame(animate);
				    
				controls.update();
				
				stats.update();
			}

           
            // Sun and Planets' rotation movements
            function rotationMovements() {
                var speedRotationSun = 0.0001 * 27;
                var speedRotationMercuryPlanet = 0.00001 * 58;
                
                sunMesh.rotation.y += speedRotationSun;
                
                mercuryPlanetMesh.rotation.y += speedRotationMercuryPlanet;   
            }
            
            // Planets' translaction movements around the sun
            function translactionMovements() {
                
                // Creating the quarternion for the planet Mercury
                var quaternionForMercuryPlanet = new THREE.Quaternion();
                
                quaternionForMercuryPlanet.setFromAxisAngle(yAxis, 0.00005);
                mercuryPlanetMesh.position.applyQuaternion(quaternionForMercuryPlanet);   
            }
            
			function render() {
                requestAnimationFrame(render);
                rotationMovements();
                translactionMovements();
				renderer.render(solarSystemScene, camera);
			}
		</script>
	</body>
</html>