<!-- Computer Graphics and Interfaces 2016-2017 -->

<!-- Lab Work 1 - Fractals - Sets of Mandelbrot and Julia -->

<!-- 45404 Daniel Pimenta d.pimenta@campus.fct.unl.pt -->
<!-- 42648 Ruben Barreiro r.barreiro@campus.fct.unl.pt -->


<!DOCTYPE html>
<html>
<head>
    
<script id="vertex-shader" type="x-shader/x-vertex">
        uniform float scale;
        uniform vec2 center;
        
        attribute vec4 vPosition;
        varying vec2 fPosition;
	
        void main() {
            gl_Position = vPosition;
            fPosition = vec2(center.x+vPosition.x/scale, center.y+vPosition.y/scale);
        }   
</script>
    
<script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;
        
        uniform float factor;
        uniform vec2 c;
        uniform bool mandelbrot;
	
        const int maxiterations = 100; 
        
        varying vec2 fPosition;
        
        int fractal(vec2 z0, vec2 c) {
            vec2 z = z0;
            for (int i = 0; i < maxiterations; i++) {
                z = vec2(z.x * z.x - z.y * z.y, z.x * z.y + z.x * z.y) + c; 
                if (z.x * z.x + z.y * z.y > 4.0)
                    return i;
            }
            return -1;
        }
        
        vec3 paletize(float v, float factor) {
            if (v < 0.0) 
                return vec3(0);
            float vv = v * factor;
            return vec3(sin(vv/3.0), cos(vv/6.0), cos(vv/(12.0+3.14/4.0)));
        }
        
        void main() { 
            vec2 z0 = mandelbrot ? c : fPosition;
            vec2 c0 = mandelbrot ? fPosition : c;

            int color_index = fractal(z0, c0);
            vec3 color = paletize(float(color_index), factor);
            
            gl_FragColor = vec4(color, 1.0);
        }
</script>
    
<script type="text/javascript" src="Fractals.js"></script>
<script type="text/javascript" src="../Common/webgl-utils.js"></script>
<script type="text/javascript" src="../Common/initShaders.js"></script>
<script type="text/javascript" src="../Common/MV.js"></script>
    
</head>
    
<body>
    <title>Fractals - Benoit Mandelbrot & Gaston Julia</title>
    Use 'Q' and 'A' keys dive/emerge. Use click/drag/release to move center point.
    <br>
    <canvas id="gl-canvas" width="512" height="512">
        Oops... your browser doesn't support the HTML5 canvas element"
    </canvas>
    <br>
    Factor: <input id="factor" type="range" min="0.00" max="2.00" step="0.01" value="1.0">
    Fractal type: <select id="fractal">
        <option>Mandelbrot</option>
        <option>Julia c=-0.4+0.6i</option>
        <option>Julia c=0.285+0i</option>
        <option>Julia c=0.285+0.01i</option>
        <option>Julia c=-0.8+0.156i</option>
        <option>Julia c=-0.8i</option>
        <!-- extra -->
        <option>Julia c=0.45+0.1428i</option>
        <option>Julia c=-0.70176-0.3842i</option>
        <option>Julia c=-0.835-0.2321i</option>
</select>
</body>
</html>